<!doctype html>
<html><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Products - Pack My Cake</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="/css/style.css">
</head><body>
<nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
  <div class="container">
    <a class="navbar-brand fw-bold" href="/">Pack My Cake</a>
    <div class="ms-auto"><a href="/cart.html" class="btn btn-outline-primary">Cart <span id="cartCount" class="badge bg-danger ms-1">0</span></a></div>
  </div>
</nav>

<main class="container my-4">
  <div class="row mb-3">
    <div class="col-md-6"><input id="search" class="form-control" placeholder="Search products"></div>
    <div class="col-md-3"><select id="category" class="form-select"><option value=''>All categories</option></select></div>
    <div class="col-md-3 text-end"><small>HSN: 4819 • GST: 18%</small></div>
  </div>
  <div id="list" class="row gy-3"></div>
</main>

<script src="/js/app.js"></script>
<script>
(async function(){ await load(); updateCartCount(); })();
async function load(){
  const q = new URLSearchParams(location.search).get('q') || '';
  const cat = '';
  const res = await fetch('/api/products?q='+encodeURIComponent(q)+'&category='+encodeURIComponent(cat));
  const data = await res.json();
  const cats = [...new Set(data.map(d=>d.category))];
  document.getElementById('category').innerHTML = '<option value="">All categories</option>' + cats.map(c=>`<option>${c}</option>`).join('');
  document.getElementById('list').innerHTML = data.map(p=>`
    <div class="col-sm-6 col-md-4">
      <div class="card h-100">
        <img src="${p.image||'/images/placeholder.png'}" class="card-img-top" style="height:160px;object-fit:contain">
        <div class="card-body d-flex flex-column">
          <h6>${p.title}</h6>
          <p class="small text-muted">${p.size} • MOQ: ${p.moq}</p>
          <p class="mb-2">${p.description || ''}</p>
          <div class="mt-auto d-flex justify-content-between align-items-center">
            <strong>₹${Number(p.price).toFixed(2)}</strong>
            <div>
              <input id="qty_${p.id}" type="number" class="form-control form-control-sm d-inline-block" style="width:80px" value="${p.moq}">
              <button class="btn btn-sm btn-primary" onclick="addToCartUI(${p.id})">Add</button>
            </div>
          </div>
        </div>
      </div>
    </div>`).join('');
}

async function addToCartUI(id){
  const res = await fetch('/api/products/'+id);
  const p = await res.json();
  const qty = Number(document.getElementById('qty_'+id).value) || p.moq || 1;
  if (qty < (p.moq||1)){ alert('MOQ is ' + p.moq); return; }
  addToCart({ id: p.id, title: p.title, price: p.price, moq: p.moq }, qty);
  showToast('Added to cart');
  updateCartCount();
}
function showToast(msg){ const t = document.createElement('div'); t.className='toast align-items-center text-white bg-dark border-0 position-fixed'; t.style.right='20px'; t.style.bottom='20px'; t.innerHTML=`<div class="d-flex"><div class="toast-body">${msg}</div><button class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div>`; document.body.appendChild(t); const bs = new bootstrap.Toast(t,{delay:1500}); bs.show(); t.addEventListener('hidden.bs.toast', ()=>t.remove()); }
function updateCartCount(){ const c = getCart(); document.getElementById('cartCount').innerText = c.reduce((s,i)=>s+i.qty,0); }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body></html>
