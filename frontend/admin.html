<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Admin - Pack My Cake</title><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/style.css"></head><body>
<nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom"><div class="container"><a class="navbar-brand fw-bold" href="/">Pack My Cake</a></div></nav>
<main class="container my-4">
  <h3>Admin Panel</h3>
  <div class="mb-3"><button id="seedAdmin" class="btn btn-secondary">Login as seeded admin</button></div>
  <h5>Add Product</h5>
  <form id="prodForm" class="row g-2 mb-4">
    <div class="col-md-4"><input id="title" class="form-control" placeholder="Title"></div>
    <div class="col-md-2"><input id="price" class="form-control" type="number" placeholder="Price"></div>
    <div class="col-md-2"><input id="moq" class="form-control" type="number" placeholder="MOQ"></div>
    <div class="col-md-2"><input id="size" class="form-control" placeholder="Size"></div>
    <div class="col-md-2"><input id="category" class="form-control" placeholder="Category"></div>
    <div class="col-12"><input id="image" class="form-control" placeholder="Image URL"></div>
    <div class="col-12"><textarea id="desc" class="form-control" placeholder="Description"></textarea></div>
    <div class="col-12"><button class="btn btn-primary">Add Product</button></div>
  </form>

  <h5>Orders</h5>
  <div id="orders"></div>
</main>
<script src="/js/app.js"></script>
<script>
document.getElementById('seedAdmin').addEventListener('click', async ()=>{
  try{ const res = await fetch('/api/auth/login', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email:'admin@packmycake.local', password:'Admin@123'}) }); const data = await res.json(); if (!res.ok) throw data; saveAuth(data.token, data.user); alert('Admin logged in'); loadOrders(); }catch(e){ alert('Admin login failed'); }
});

document.getElementById('prodForm').addEventListener('submit', async e=>{
  e.preventDefault();
  try{
    const payload = { title: document.getElementById('title').value, price: Number(document.getElementById('price').value), moq: Number(document.getElementById('moq').value)||1, size: document.getElementById('size').value, category: document.getElementById('category').value, description: document.getElementById('desc').value, image: document.getElementById('image').value || '/images/placeholder.png' };
    const auth = getAuth();
    if (!auth.token) return alert('Please login as admin');
    const res = await fetch('/api/products', { method: 'POST', headers: { 'Content-Type':'application/json','Authorization':'Bearer '+auth.token }, body: JSON.stringify(payload) });
    const data = await res.json(); if (!res.ok) throw data;
    alert('Product added'); location.href='/products.html';
  }catch(err){ alert('Add failed: ' + (err.error||JSON.stringify(err))); }
});

async function loadOrders(){
  try{
    const auth = getAuth(); if (!auth.token) return;
    const res = await fetch('/api/orders', { headers: { 'Authorization':'Bearer '+auth.token } });
    const data = await res.json(); if (!res.ok) throw data;
    const area = document.getElementById('orders');
    if (!data.length) { area.innerHTML = '<p>No orders</p>'; return; }
    area.innerHTML = data.map(o=>`<div class="card mb-2"><div class="card-body"><h6>Order #${o.id} — ₹${o.total.toFixed(2)}</h6><p><strong>${o.customer_name}</strong> (${o.customer_email})</p><p>${o.shipping_address}</p><p>Items:<ul>${o.items.map(it=>`<li>${it.title} × ${it.qty}</li>`).join('')}</ul></p><small>${o.created_at}</small></div></div>`).join('');
  }catch(e){ console.error(e); }
}

window.addEventListener('load', ()=>{ if (getAuth().token) loadOrders(); });
</script>
</body></html>
